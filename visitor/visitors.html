<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Visitors</title>

	<link rel="stylesheet" type="text/css" href="../resources/lib/bootstrap/css/bootstrap.min.css">

	<script src="../resources/lib/js/jquery-3.1.1.min.js"></script>
	<script src="../resources/lib/bootstrap/js/bootstrap.min.js"></script>
</head>

<body>
<div class="container">
	<ul class="nav nav-tabs">
		<li class="nav-item">
			<a class="nav-link active" data-toggle="tab" href="#all-visitors">Все гости</a>
		</li>
		<li class="nav-item">
			<a class="nav-link" data-toggle="tab" href="#transfer">Трансфер</a>
		</li>
		<li class="nav-item">
			<a class="nav-link" data-toggle="tab" href="#events">События</a>
		</li>
		<li class="nav-item">
			<a class="nav-link" data-toggle="tab" href="#drinks">Напитки</a>
		</li>
		<li class="nav-item">
			<a class="nav-link" data-toggle="tab" href="#main-meal">Основное блюдо</a>
		</li>
	</ul>

	<div class="tab-content">
		<div class="tab-pane active" id="all-visitors" role="tabpanel">
			<table id="visitors-table" class="table">
				<thead>
				<tr>
					<th>Имя</th>
					<th>Трансфер</th>
					<th>События</th>
					<th>Напитки</th>
					<th>Основное блюдо</th>
					<th>Доп. инфо</th>
				</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>
		<div class="tab-pane" id="transfer" role="tabpanel">
			<table id="transfer-table" class="table">
				<thead>
				<tr>
					<th>Откуда</th>
					<th>Кол-во</th>
				</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>
		<div class="tab-pane" id="events" role="tabpanel">
			<table id="events-table" class="table">
				<thead>
				<tr>
					<th>Событие</th>
					<th>Кол-во</th>
				</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>
		<div class="tab-pane" id="drinks" role="tabpanel">
			<table id="drinks-table" class="table">
				<thead>
				<tr>
					<th>Событие</th>
					<th>Кол-во</th>
				</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>
		<div class="tab-pane" id="main-meal" role="tabpanel">
			<table id="main-meal-table" class="table">
				<thead>
				<tr>
					<th>Основное блюдо</th>
					<th>Кол-во</th>
				</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>
	</div>
</div>

<script>
    $(document).ready(function () {
        var url = "/cgi-bin/get-statistic.py";

        $.ajax({
            type: "get",
            url: url,
//            contentType: 'application/json',
            dataType: "json",
            success: function (data) {
                for (var i = 0; i < data.visitors.length; i++) {
                    addWillGoRow("visitors-table", data.visitors[i]);
                }
                for (var i = 0; i < data.transferStatistic.length; i++) {
                    addTransferRow("transfer-table", data.transferStatistic[i])
                }
                for (var i = 0; i < data.eventsStatistic.length; i++) {
                    addTransferRow("events-table", data.eventsStatistic[i])
                }
                for (var i = 0; i < data.drinksStatistic.length; i++) {
                    addTransferRow("drinks-table", data.drinksStatistic[i])
                }
                for (var i = 0; i < data.mainMealStatistic.length; i++) {
                    addTransferRow("main-meal-table", data.mainMealStatistic[i])
                }
            }
        });
    });

    function addWillGoRow(tableId, obj) {
        var row =
            "<tr><td>" + obj.name +
            "</td><td>" + obj.transfer +
            "</td><td>" + writeLikeList(obj.events) +
            "</td><td>" + writeLikeList(obj.drinks) +
            "</td><td>" + obj.mainMeal +
            "</td><td>" + obj.note +
            "</td></tr>";

        $("#" + tableId).append(row);
    }

    function addTransferRow(tableId, obj) {
        var row =
            "<tr><td>" + obj.position +
            "</td><td>" + obj.persons.length +
            "</td></tr>";

        $("#" + tableId).append(row);
    }

    function writeLikeList(items) {
        var text = "";
        for (var i = 0; i < items.length; i++) {
            text += items[i] + "<br/>";
        }
        return text;
    }
</script>

</body>
</html>